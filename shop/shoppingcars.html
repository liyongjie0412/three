<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<style type="text/css">
			a{
				text-decoration: none;
				-webkit-tap-highlight-color: white;
			}
			body{
				background: #f2f3f5;
				margin: 0 auto;
				 display: flex;
	            width: 100%;
	            height: 100%;
	            box-orient:vertical;
	            flex-direction:column;
			}
			#header{
				width: 100%;
				height: 1rem;
				position: fixed;
				top: 0;
				text-align: center;
				border-bottom: 0.05rem solid #cbcbc9;
				background: white;
			}
			#main{
				box-sizing: border-box;
				flex:1;
				width: 100%;
				margin-top: 0rem;
				background: white;
				/*height: 320px;*/
				padding: 5px 0;
				font-size: 0.8rem;
				border-bottom: 1px solid #D7D7D7;
			}
			img{
				width: 100%;
    			height: 100%;
				border: 0.05rem solid #d7d7d7;
				border-radius: 0.15rem;
				max-width: 100%;
    			max-height: 100%;
			}
			#img {
			    width: 50px;
			    height: 50px;
			    border: 1px solid #000;
			    margin-left: 10px;
			 }
			#main p{
				margin-top: 0px;
			}
			#main dl{
				/*height: 120px;*/
				padding: 10px 0;
			}
			#main2{
				flex:1;
				width: 100%;
				background: white;
				height: 420px;
				font-size: 0.8rem;
				border-bottom: 1px solid #D7D7D7;
			}
			#main2 p{
				margin-top: 0px;
			}
			#main2 dl{
				/*height: 120px;*/
				padding: 10px 0;
				margin: 0;
			}
			#main3{
				box-sizing: border-box;
				width: 100%;
				height: 50px;
				border: 1px solid #D7D7D7;
				background: white;
			}
			footer{
				height: 40px;
				width: 100%;
				display: flex;
				justify-content: space-between;
				position: fixed;
				bottom: 0px;
				border-top: 1px solid #ccc;
				padding: 10px 0;
				box-shadow: 0px -2px 20px #ccc;
				background: white;
			}
			footer a{
				display: block;
				width: 25%;
			}
			footer a img{
				width: 30%;
				margin-left: 35%;
				margin-bottom: -5px;
				border: none;
			}
			footer a p{
				margin-top: 0;
				color: grey;
				text-align: center;
				font-size: 14px;
			}
			.circle{
				width: 18px;
				height: 18px;
				border: 2px solid #b4b3b9;
				border-radius: 50%;
				float: left;
				margin-right: 5px;
				margin-left: 5px;
			}
			.col{
				background-color: red;
			}
		</style>
	</head>
	<body>

		<div id="main" o="">
			<dl>
				<dt style="float: left;"><p style="margin-top: 30px;" class="circle"></p><img src="images/mylist (3)_1.png" style=" margin-right:10px;width: 90px; height: 90px;"/></dt>
				<dd style="height: 70px;"><span>小米（MI）路由器3 1200M千兆5G双频<br/><span>四稳定穿墙...</span></span></dd>
				<dd style="color: #82828c;"><span style="font-size: 0.7rem;">重量:0.51kg 颜色:【1200M】小米...</span><span style="margin-left: 0px;font-size: 0.7rem;">选服务</span></dd>
				<dd style="margin-top: 10px;"><span style="color: #de463b; font-size: 1.2rem;" >￥139.00</span><span style="margin-left: 40px;"><button style="border: 1px solid #D7D7D7; background: white; width: 30px; height: 30px; font-size: 15px;" class="jian">-</button><button style="border: 0.05rem solid #D7D7D7; font-size: 15px; background: white; width: 40px; height: 30px;" class="val">1</button><button style="border: 1px solid #D7D7D7; font-size: 15px; background: white; width: 30px; height: 30px;" class="add">+</button></span></span></dd>
				<dd style="clear: both;"></dd>
			</dl>
		</div>
	</div>	
	<div style="margin-bottom: 120px;"></div>
	<div id="main3" style="position: fixed; bottom: 60.8px;"><p style="margin-top: 11px;" class="circle q" n="" p=""></p><span style="line-height: 40px;padding-left: 20px;vertical-align: 20px;">全选 </span><span style="color: black; font-size: 1rem; line-height: 40px; vertical-align: 20px;" id="sum">合计￥<span id="s">00</span></span>
		<a href="ConfirmPayment.html"><div style="float: right; background: red; width: 30%; height: 50px; color: white; text-align: center; line-height: 50px;">去結算(<span id="num">0</span>)</div></a>
	</div>
			<footer>
			<a href="index.html">
				<div>
					<img src="images/icon_home.png"/>
					<p>首页</p>
				</div>			
			</a>
			<a href="list.html">
				<div>
					<img src="images/icon_cate.png"/>
					<p>分类</p>
				</div>
			</a>
			<a href="shoppingcars.html">
				<div>
					<img src="images/icon_cart_selected.png"/>
					<p style="color: red;">购物车</p>
				</div>
			</a>
			<a href="myself.html">
				<div>
					<img src="images/icon_member.png"/>
					<p>我的</p>
				</div>
			</a>
		</footer>
	</body>
	<script src="jquery-1.8.2.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
        var o=0;
        /**
         * [s_num description]
         * @param  {[type]} obj    [description]
         * @param  {[type]} status [description]
         * @param  {[type]} val    [description]
         * @return {[type]}        [description]
         */
         function s_num(obj,status,val){
         	var par=obj.parents("div").find("p").attr("class");
         	var price=parseInt($("#s").text());
         	var num=parseInt($("#num").text());
         	var p=parseInt(obj.parents("div").find("p").attr("p"));
         	 if(par=="circle col"){
         	 	  if(status=="+"){
         	 	  	$("#s").html(price+p);
		            $("#num").html(num+1);
         	 	  }else{
         	 	  	$("#s").html(price-p);
		            $("#num").html(num-1);
         	 	  }
             }
         }
		$(function(){
		$(document).on("click",".add",function(){
			var count= parseInt($(this).prev().text());
			if(count==99){
               return false;
			}
			count+=1
         $(this).prev().text(count)
         ajax("",1,$(this).parent().attr("pro_id"))
         var obj=$(this);
         s_num(obj,"+",count)
		})
		$(document).on("click",".jian",function(){
			var count= parseInt($(this).next().text());
			if(count==1){
               return false;
			}
			count-=1
         $(this).next().text(count)
       ajax("",1,$(this).parent().attr("pro_id"))
       var obj=$(this);
       s_num(obj,"-",count)
         		         	// alert(localStorage.getItem("goodscart"))
         // alert(localStorage.getItem("goodscart")
		})
		$(document).on("click",".circle",function(){
			/*
			 *   n             点击全选时的总数量
			 *   val           总金额
			 *   num           总数量
			 *   p             总价/单价
			 *   l             有多个dl元素（有多少件商品）
			 *   n1            单价商品的数量
			 */
            var  n1=parseInt($(this).parents("dt").nextAll().find(".val").text());
			var  val=parseInt($("#s").text());
			var  num=parseInt($("#num").text());
			var  p=parseInt($(this).attr("p"));
			var  n=parseInt($(this).attr("n"));
			var  l=$("#main").attr("o");
			if($(this).attr("class")=="circle"){
				// 选择
				$(this).addClass("col");
				sum=val+p*n1;
				num=num+n1;
				o+=1;
			}else if($(this).attr("class")=='circle q'){
				// 全选
                $(".circle").addClass("col")
                 sum=p;
                 num=n;
                 o=l;
			}else if($(this).attr("class")=='circle q col'){
                 // 全不选
                $(".circle").removeClass("col");
                sum='00.00';
                num=0;
                o=0;
			}else{
				//取消选中
				$(this).removeClass("col");
				sum=val-p*n1;
				num=num-n1;
				o-=1;
			}
			if(o==l){
				 $(".q").addClass("col")
			}else{
				$(".q").removeClass("col")
			}
			$("#s").html(sum);
            $("#num").html(num);
		})
		})
		/**
		 * [ajax description]
		 * @param  {String} "id [description]
		 * @return {[type]}     [description]
		 */
		    function ajax(id="",count="",pro_id=""){
		    	var content=localStorage.getItem("goodscart");
		         $.get("http://"+sever_path+"comm/goodscart/num",{"access_token":"84d2acebe4a6","count":count,"id":id,"pro_id":pro_id,"content":content},function(data){
		         	if(data.status==0){
                      $(".q").attr("n",data.data.count);
                      $(".q").attr("p",data.data.sum);
		         	localStorage.setItem("goodscart",data.data.jsonstr);
		         	}
		         	
		         },"jsonp")
		    }
	</script>
	
	<script src="./path.js"></script>
	<script>
	$(function(){
		var content=localStorage.getItem("goodscart");
	 $.get("http://"+sever_path+"comm/goodscart/goodscart",{"access_token":"84d2acebe4a6","content":content},function(data){
                //alert(data.status);
                    if(data.status==0)
                  {
                  	  var str="";
                  	  var l=0;
                      $.each(data.data.goodsList,function(k,v){
                      	// alert(v.img)
                      str+='<div><dt style="float: left;"><p p="'+v.sell_price+'"  n="'+v.count+'" class="circle" style="margin-top:30px;"></p><img src="http://localhost/htdocs/shop/alidata/www/default/pp/'+v.img+'" style=" margin-right:10px;width: 90px; height: 90px;"/></dt><dd  style="height: 60px;"><span>'+v.name+'</dd><dd style="color: #82828c;"><span style="font-size: 0.7rem;">重量:0.51kg 颜色:【1200M】小米...</span><span style="margin-left: 0px;font-size: 0.7rem;">选服务</span></dd><dd style="margin-top: 10px;"><span style="color: #de463b; font-size: 1.2rem;" >￥'+v.sell_price+'</span><span style="margin-left: 40px;" pro_id="'+v.product_id+'"><button style="border: 1px solid #D7D7D7; background: white; width: 30px; height: 30px; font-size: 15px;" class="jian">-</button><button style="border: 0.05rem solid #D7D7D7; font-size: 15px; background: white; width: 40px; height: 30px;" class="val">'+v.count+'</button><button style="border: 1px solid #D7D7D7; font-size: 15px; background: white; width: 30px; height: 30px;" class="add">+</button></span></span></dd><dd style="clear: both;"></dd></dl></div>'
                          l+=1;
                      })
                      // $("#sum").html("合计￥"+data.data.final_sum);
                      // $("#num").html(data.data.count);
                      $("#main").attr("o",l);
                      // alert(data.data.sum)
                      $(".q").attr("n",data.data.count);
                      $(".q").attr("p",data.data.sum);
                      $("#main").html(str);
                  }else
                  {
                     alert("系统繁忙,请重试")
                  }

                },"jsonp")
	 })

	</script>
</html>
<dl>